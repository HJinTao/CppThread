# Cpp多线程详解



## 1.1 CPU相关参数

| 参数名称                                 | 含义                 | 与多线程关系                     |
| ---------------------------------------- | -------------------- | -------------------------------- |
| **Cores（核心数）**                      | 实际的物理处理单元数 | 每个核心可执行一个线程           |
| **Threads（线程数）**                    | 可同时处理的线程数   | 表示 CPU 的并发能力              |
| **Hyper-Threading** 或 SMT（对称多线程） | 每个核心运行多个线程 | 实现一个核心同时运行多个线程     |
| **L1/L2/L3 Cache**                       | 各级缓存             | 缓存命中率影响线程执行效率       |
| **Clock Speed（主频）**                  | 每秒执行的指令周期   | 与多线程无直接关系，但影响总性能 |
| **TDP**（热设计功耗）                    | CPU发热量（功率）    | 高并发运行时功耗和散热有关       |



## 1.2 核心概念

线程是程序中的轻量级执行单元，允许程序同时执行多个任务。

多线程是多任务处理的一种特殊形式，多任务处理允许让电脑同时运行两个或两个以上的程序。

一般情况下，两种类型的多任务处理：**基于进程和基于线程**。

- 基于进程的多任务处理是程序的**并发**执行。
- 基于线程的多任务处理是同一程序的片段的**并发**执行。

### 线程(Thread)

- 线程是程序执行中的单一顺序控制流，多个线程可以在同一个进程中独立运行。
- 线程共享进程的**地址空间**、文件描述符、**堆**和**全局变量**等资源，但每个线程有自己的**栈**、**寄存器**和**程序计数器**。

### 并发 (Concurrency) 与并行 (Parallelism)

- **并发**：多个任务在时间片段内交替执行，表现出同时进行的效果。

  在**单核 CPU** 上，同时只能执行一个线程；

  操作系统通过“时间片轮转”让多个线程交替运行；

  比如线程 A 执行 10ms，暂停后线程 B 执行 10ms……，用户感觉它们在“同时”运行；

  属于 **并发**。

- **并行**：多个任务在多个处理器或处理器核上同时执行。

  在**多核 CPU** 上，每个核心可以执行一个线程；

  如果你开了 4 个线程，有 4 个核心，它们可以真正**同时运行**；

  属于 **并行**

> 实际多线程编程中通常写的是“**并发程序**”，由操作系统决定能否**并行运行**。



## 1.3 C++多线程核心组件

### C++11 及以后的标准提供了多线程支持，核心组件包括：

- **`std::thread`**：用于创建和管理线程。
- **`std::mutex`**：用于线程之间的互斥，防止多个线程同时访问共享资源。
- **`std::lock_guard`** 和 **`std::unique_lock`**：用于管理锁的获取和释放。
- **`std::condition_variable`**：用于线程间的条件变量，协调线程间的等待和通知。
- **`std::future`** 和 **`std::promise`**：用于实现线程间的值传递和任务同步

### 编译命令

```sh
g++ -std=c++11 -pthread example.cpp -o example 
```

`-std=c++11`：启用 C++11 标准

`-pthread`：启用 POSIX 线程支持

## 1.4 创建线程























































